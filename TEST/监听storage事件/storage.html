<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>test storage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
</head>
<body>
    <input id="tInput" type="text"/>
    <button onclick="addItem()">add</button>
    <button onclick="getItem()">get</button>
    <br>
    <p>先通过add操作，添加一个缓存信息；然后点击下面的a连接，修改这个缓存信息；回到本页面，查看监听事件；</p>
    <p>
        <a href="storageChange.html" target="_blank" title="修改storage">同源修改storage</a>
    </p>
    <p id="changeResult"></p>
<script>
    window.addEventListener('storage', function (e) {
        let p = document.getElementById('changeResult');
        p.innerHTML = `oldValue: ${e.oldValue}<br>newValue: ${e.newValue}<br>from: ${e.url}`;
    }, false);

    function addItem() {
        let value = document.getElementById('tInput').value;
        localStorage[value] = value;
    }

    function getItem() {
        let v = document.getElementById('tInput').value;
        console.log(localStorage[v], 'getItem');
    }

    function changeItem() {
        let k = document.getElementById('changeInputKey').value;
        let v = document.getElementById('changeInputValue').value;
        let p = document.getElementById('changeResult');
        p.innerHTML = `oldValue: ${localStorage[k]}<br>newValue: ${v}<br>from: this's page`;
        localStorage.setItem(k, v);
    }
</script>
</body>
</html>